---
wave: 2
depends_on:
  - 09-01
files_modified:
  - includes/admin/class-settings-page.php
  - includes/admin/tabs/class-wizard-tab.php
  - includes/admin/tabs/class-line-settings-tab.php
  - includes/admin/tabs/class-login-settings-tab.php
  - includes/admin/tabs/class-webhook-tab.php
  - includes/admin/tabs/class-developer-tab.php
  - includes/admin/tabs/class-settings-tab.php (removed)
  - includes/admin/tabs/class-login-tab.php (removed)
  - includes/admin/views/tab-wizard.php
  - includes/admin/views/tab-line-settings.php
  - includes/admin/views/tab-login-settings.php
  - includes/admin/views/tab-webhook.php
  - includes/admin/views/tab-developer.php
  - includes/admin/views/tab-settings.php (removed)
  - includes/admin/views/tab-login.php (removed)
autonomous: true
requirements:
  - TAB-01
  - TAB-03
  - TAB-04
---

# Plan 09-02: 5 Tab 重組

**目標：** 從 3 Tab 重組為 5 Tab（設定嚮導、LINE 設定、登入設定、Webhook、開發者），建立舊 slug redirect，各 Tab 獨立 form 隔離。

## Tasks

<task id="1">
  <objective>建立 WizardTab（設定嚮導）</objective>
  <files>
    includes/admin/tabs/class-wizard-tab.php
    includes/admin/views/tab-wizard.php
  </files>
  <action>
    1. 建立 WizardTab 類別（slug='wizard'，label='設定嚮導'）
    2. 從 tab-settings.php 搬移「連線狀態總覽」和「設定步驟說明」到 tab-wizard.php
    3. WizardTab 無需 save() — 嚮導頁只讀不寫
    4. view 中加入快速設定連結，導向各 Tab
  </action>
  <verify>php -l 通過</verify>
  <done>false</done>
</task>

<task id="2">
  <objective>重構 SettingsTab → LineSettingsTab</objective>
  <files>
    includes/admin/tabs/class-line-settings-tab.php
    includes/admin/views/tab-line-settings.php
  </files>
  <action>
    1. 將 SettingsTab 重命名為 LineSettingsTab（slug='line-settings'，label='LINE 設定'）
    2. 從 tab-settings.php 保留 Messaging API、Login Channel、NSL 三個 card 到 tab-line-settings.php
    3. 刪除已搬到 WizardTab 的「連線狀態」和「設定步驟說明」
    4. save() 保持不變（save_messaging + save_login + save_nsl）
    5. 刪除舊的 class-settings-tab.php 和 tab-settings.php
  </action>
  <verify>php -l 通過</verify>
  <done>false</done>
</task>

<task id="3">
  <objective>重構 LoginTab → LoginSettingsTab</objective>
  <files>
    includes/admin/tabs/class-login-settings-tab.php
    includes/admin/views/tab-login-settings.php
  </files>
  <action>
    1. 將 LoginTab 重命名為 LoginSettingsTab（slug='login-settings'，label='登入設定'）
    2. 將 tab-login.php 重命名為 tab-login-settings.php
    3. 更新 view 中的 hidden tab value 為 'login-settings'
    4. save() 邏輯不變
    5. 刪除舊的 class-login-tab.php 和 tab-login.php
  </action>
  <verify>php -l 通過</verify>
  <done>false</done>
</task>

<task id="4">
  <objective>拆分 DeveloperTab，建立 WebhookTab</objective>
  <files>
    includes/admin/tabs/class-webhook-tab.php
    includes/admin/views/tab-webhook.php
    includes/admin/tabs/class-developer-tab.php
    includes/admin/views/tab-developer.php
  </files>
  <action>
    1. 建立 WebhookTab 類別（slug='webhook'，label='Webhook'）
    2. 從 tab-developer.php 搬移「Webhook 事件記錄」card 到 tab-webhook.php
    3. 更新 DeveloperTab 的 view（移除 Webhook 部分）
    4. WebhookTab 無需 save()
  </action>
  <verify>php -l 通過</verify>
  <done>false</done>
</task>

<task id="5">
  <objective>更新主類別 Tab 註冊和舊 slug redirect</objective>
  <files>includes/admin/class-settings-page.php</files>
  <action>
    1. 更新 get_tabs() 方法，註冊 5 個 Tab（wizard, line-settings, login-settings, webhook, developer）
    2. 預設 Tab 從 'settings' 改為 'wizard'
    3. 在 render_page() 加入舊 slug redirect：
       - settings → line-settings
       - login → login-settings
       使用 wp_redirect + exit
    4. handle_save() 更新 Tab slug 映射
    5. handle_test_connection() redirect 改為 tab=line-settings
  </action>
  <verify>
    1. 5 個 Tab 在 get_tabs() 中正確註冊
    2. 舊 slug redirect 邏輯存在
    3. php -l 通過
  </verify>
  <done>false</done>
</task>

## must_haves

truths:
  - 5 Tab 順序：wizard → line-settings → login-settings → webhook → developer
  - 舊 slug 映射：settings → line-settings, login → login-settings
  - developer slug 不變，不需 redirect
  - 每個 Tab view 的 form hidden field `name="tab"` 值必須與 Tab slug 一致
  - save() 只在有 form 的 Tab 才需實作（wizard 和 webhook 不需要）

key_links:
  - includes/admin/class-settings-page.php
  - includes/admin/tabs/ 目錄
  - includes/admin/views/ 目錄
