---
wave: 1
depends_on: []
files_modified:
  - includes/admin/class-settings-page.php
  - includes/admin/tabs/class-abstract-tab.php
  - includes/admin/tabs/class-settings-tab.php
  - includes/admin/tabs/class-login-tab.php
  - includes/admin/tabs/class-developer-tab.php
autonomous: true
requirements:
  - TAB-02
---

# Plan 09-01: Tab 架構拆分

**目標：** 建立 Tab 類別架構，將現有 3 Tab 的邏輯從 SettingsPage 搬到獨立 Tab 類別，主類別瘦身到 < 200 行。

此步驟保持 3 Tab 不變（settings/login/developer），只做結構拆分。

## Tasks

<task id="1">
  <objective>建立 Tab 抽象基底類別</objective>
  <files>includes/admin/tabs/class-abstract-tab.php</files>
  <action>
    建立 `LineHub\Admin\Tabs\AbstractTab` 抽象類別，定義 Tab 介面：
    - `abstract get_slug(): string`
    - `abstract get_label(): string`
    - `abstract render(): void`
    - `save(array $post_data): bool`（預設 return true，子類別可覆寫）
    - `get_view_path(string $filename): string`（輔助方法，回傳 view 檔案路徑）
  </action>
  <verify>檔案存在且語法正確（php -l）</verify>
  <done>false</done>
</task>

<task id="2">
  <objective>建立 SettingsTab 類別（搬移 settings Tab 邏輯）</objective>
  <files>includes/admin/tabs/class-settings-tab.php</files>
  <action>
    建立 `LineHub\Admin\Tabs\SettingsTab`，從 SettingsPage 搬移：
    - render_settings_tab() → render()
    - save_settings_tab() + save_messaging_section() + save_login_section() + save_nsl_section() → save()
    - handle_test_connection() → test_connection()（作為 Tab 的操作方法）
    slug = 'settings'，label = '設定'
  </action>
  <verify>php -l 通過</verify>
  <done>false</done>
</task>

<task id="3">
  <objective>建立 LoginTab 類別（搬移 login Tab 邏輯）</objective>
  <files>includes/admin/tabs/class-login-tab.php</files>
  <action>
    建立 `LineHub\Admin\Tabs\LoginTab`，從 SettingsPage 搬移：
    - render_login_tab() → render()
    - save_login_tab() → save()
    slug = 'login'，label = '登入'
  </action>
  <verify>php -l 通過</verify>
  <done>false</done>
</task>

<task id="4">
  <objective>建立 DeveloperTab 類別（搬移 developer Tab 邏輯）</objective>
  <files>includes/admin/tabs/class-developer-tab.php</files>
  <action>
    建立 `LineHub\Admin\Tabs\DeveloperTab`，從 SettingsPage 搬移：
    - render_developer_tab() → render()
    - handle_generate_api_key() 和 handle_revoke_api_key() 保留在主類別（因為它們是 admin_post action）
    slug = 'developer'，label = '開發者'
  </action>
  <verify>php -l 通過</verify>
  <done>false</done>
</task>

<task id="5">
  <objective>重構 SettingsPage 主類別（瘦身到 < 200 行）</objective>
  <files>includes/admin/class-settings-page.php</files>
  <action>
    重構 SettingsPage：
    1. TABS 常數改為 Tab 物件陣列（由 get_tabs() 方法生成）
    2. render_page() 用 Tab 物件的 get_slug()/get_label()/render()
    3. handle_save() 根據 tab slug 找到對應 Tab 物件，呼叫其 save()
    4. 刪除所有已搬到 Tab 類別的 render/save 方法
    5. 保留：register_menu, enqueue_assets, handle_save（路由），handle_generate_api_key, handle_revoke_api_key, handle_test_connection, show_admin_notices
    6. 目標 < 200 行
  </action>
  <verify>
    1. 主類別行數 < 200
    2. php -l 通過
    3. 所有 Tab 類別 php -l 通過
  </verify>
  <done>false</done>
</task>

## must_haves

truths:
  - Autoloader 支援 `LineHub\Admin\Tabs` 命名空間 → `includes/admin/tabs/`
  - 現有 view 檔案路徑不變（tabs/ 類別用 `dirname(__DIR__)` 找 views/）
  - nonce action 保持 `line_hub_save_settings` 不變

key_links:
  - includes/admin/class-settings-page.php（現有 441 行）
  - includes/autoload.php（PSR-4 autoloader）
  - includes/admin/views/tab-settings.php
  - includes/admin/views/tab-login.php
  - includes/admin/views/tab-developer.php
