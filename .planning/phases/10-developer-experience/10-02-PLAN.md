# Plan 10-02: Hook 文件與 API 使用記錄

## Objective

1. 擴充 Hook 文件，加入完整參數說明和實際使用情境範例
2. 新增 API 使用記錄功能，讓開發者可以在後台查看最近 20 次 API 呼叫

## Requirement Coverage

- **DEV-02**: 開發者 Tab 顯示 Hook 使用範例（PHP 程式碼片段）
- **DEV-03**: API 使用記錄：儲存並顯示最近 20 次 API 呼叫記錄

## Changes

### Step 1: 新增 ApiLogger 服務

**新增** `includes/services/class-api-logger.php`:
- `ApiLogger::log()` — 記錄 API 呼叫（時間、來源 IP、端點、HTTP 方法、結果）
- `ApiLogger::get_recent()` — 取得最近 N 筆記錄
- `ApiLogger::cleanup()` — 清理超過 100 筆的舊記錄
- 使用 `wp_options` 儲存（JSON 陣列），避免建立新資料表
- 每筆記錄結構：`{time, ip, method, endpoint, status, message}`

### Step 2: 在 PublicAPI 加入 logging middleware

**修改** `includes/api/class-public-api.php`:
- 在每個端點方法的結尾呼叫 `ApiLogger::log()`
- 記錄成功/失敗狀態

### Step 3: 擴充 DeveloperTab 傳遞 log 資料

**修改** `includes/admin/tabs/class-developer-tab.php`:
- render() 方法中取得 `ApiLogger::get_recent(20)`
- 傳遞給 view 模板

### Step 4: 更新 tab-developer.php 顯示 API log

**修改** `includes/admin/views/tab-developer.php`:
- 新增「API 使用記錄」區塊
- 顯示最近 20 筆呼叫（表格：時間、來源 IP、端點、結果）
- 空記錄時顯示提示文字

## Affected Files

| File | Action |
|------|--------|
| `includes/services/class-api-logger.php` | 新增 — API 呼叫記錄服務 |
| `includes/api/class-public-api.php` | 修改 — 加入 logging |
| `includes/admin/tabs/class-developer-tab.php` | 修改 — 傳遞 log 資料 |
| `includes/admin/views/tab-developer.php` | 修改 — 顯示 API log 區塊 |

## Verification

- PHP 語法檢查所有修改的檔案
- 確認 ApiLogger 檔案名稱符合 autoloader 命名規則
- 確認 Hook 文件包含完整參數說明
- 確認 API log 區塊有「時間、來源 IP、端點、結果」欄位
