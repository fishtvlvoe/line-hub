---
phase: 13-樣式外部化
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - assets/css/admin-views.css
  - includes/admin/class-settings-page.php
  - includes/admin/views/tab-webhook.php
  - includes/admin/views/tab-wizard.php
  - includes/admin/views/tab-line-settings.php
  - includes/admin/views/tab-login-settings.php
  - includes/admin/views/tab-developer.php
  - includes/admin/views/partials/connection-status.php
autonomous: true
requirements:
  - STYLE-01
must_haves:
  truths:
    - "用 grep -rn 'style=\"' includes/admin/ 搜尋，結果為零（所有 inline style 已移到 CSS class）"
    - "後台 5 個 Tab（嚮導、LINE 設定、登入設定、Webhook、開發者）的視覺排版與重構前完全一致"
  artifacts:
    - path: "assets/css/admin-views.css"
      provides: "Admin view 模板的所有樣式"
      min_lines: 80
    - path: "includes/admin/class-settings-page.php"
      provides: "enqueue_assets 中載入 admin-views.css"
      contains: "admin-views.css"
  key_links:
    - from: "includes/admin/class-settings-page.php"
      to: "assets/css/admin-views.css"
      via: "wp_enqueue_style"
      pattern: "wp_enqueue_style.*admin-views"
---

<objective>
將 Admin view 模板（7 個檔案，~78 個 inline style）中的所有 `style=""` 屬性移到獨立的 CSS 檔案，透過 `wp_enqueue_style` 載入。

Purpose: 滿足 STYLE-01 需求，實現 Admin 後台樣式集中管理，消除模板中的 inline style。
Output: `assets/css/admin-views.css` + 7 個零 inline style 的 view 模板。
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@assets/css/admin-tabs.css
@assets/css/developer-tab.css
@includes/admin/class-settings-page.php
</context>

<tasks>

<task type="auto">
  <name>Task 1: 建立 admin-views.css 並註冊載入</name>
  <files>
    assets/css/admin-views.css
    includes/admin/class-settings-page.php
  </files>
  <action>
    1. 建立 `assets/css/admin-views.css`，包含以下 CSS class（從 7 個 view 模板的 inline style 歸納）：

    **共用卡片與佈局：**
    - `.lh-card-narrow` — `max-width: 1000px;`（取代 card 上的 `style="max-width: 1000px;"）`
    - `.lh-card-narrow-spaced` — `max-width: 1000px; margin-top: 20px;`（取代 `style="max-width: 1000px; margin-top: 20px;"）`
    - `.lh-mt-0` — `margin-top: 0;`
    - `.lh-mt-10` — `margin-top: 10px;`
    - `.lh-mt-16` — `margin-top: 16px;`
    - `.lh-mt-20` — `margin-top: 20px;`
    - `.lh-ml-8` — `margin-left: 8px;`
    - `.lh-form-offset` — `margin: -10px 0 0 0;`（取代測試連線表單的負 margin）

    **文字顏色：**
    - `.lh-text-muted` — `color: #999;`
    - `.lh-text-secondary` — `color: #666;`
    - `.lh-text-warning` — `color: #996800;`
    - `.lh-text-success` — `color: #46b450;`
    - `.lh-text-danger` — `color: #dc2626;`
    - `.lh-text-info` — `color: #6b7280;`

    **程式碼區塊：**
    - `.lh-code-display` — `background: #f5f5f5; padding: 8px 12px; display: inline-block;`
    - `.lh-code-display-sm` — 加 `font-size: 13px;`
    - `.lh-code-display-lg` — 加 `font-size: 14px;`
    - `.lh-code-uid` — `font-size: 11px;`（LINE UID 顯示）
    - `.lh-code-ip` — `font-size: 12px;`（IP 和端點顯示）

    **表格欄寬：**
    - `.lh-col-60` — `width: 60px;`
    - `.lh-col-80` — `width: 80px;`
    - `.lh-col-120` — `width: 120px;`
    - `.lh-col-130` — `width: 130px;`
    - `.lh-col-140` — `width: 140px;`
    - `.lh-col-160` — `width: 160px;`
    - `.lh-col-180` — `width: 180px;`

    **表單元素：**
    - `.lh-label-block` — `display: block; margin-bottom: 8px;`
    - `.lh-label-block-sm` — `display: block; margin-bottom: 4px;`
    - `.lh-label-block-md` — `display: block; margin-bottom: 6px;`
    - `.lh-radio-inline-spaced` — `margin-left: 15px;`（radio 間距）

    **連線狀態：**
    - `.lh-status-list` — `list-style: none; padding-left: 0;`
    - `.lh-status-item` — `margin: 8px 0;`

    **Webhook payload：**
    - `.lh-payload-panel` — `display: none; margin-top: 10px; padding: 10px; background: #f5f5f5; border: 1px solid #ddd; border-radius: 3px;`
    - `.lh-payload-content` — `overflow-x: auto; font-size: 12px; max-height: 300px;`

    **Developer tab 特有：**
    - `.lh-api-key-banner` — `background: #dcfce7; border: 1px solid #86efac; border-radius: 6px; padding: 16px; margin: 16px 0;`
    - `.lh-api-key-banner-title` — `margin: 0 0 8px 0; font-weight: 600; color: #166534;`
    - `.lh-api-key-code` — `font-size: 14px; background: #fff; padding: 8px 12px; display: inline-block; border: 1px solid #86efac; user-select: all;`
    - `.lh-endpoint-title` — `margin-left: auto; font-size: 13px; color: #6b7280;`

    **設定嚮導：**
    - `.lh-wizard-summary` — `cursor: pointer; font-weight: 600; font-size: 14px; padding: 8px 0;`
    - `.lh-wizard-steps` — `margin-top: 15px; line-height: 2;`

    2. 在 `class-settings-page.php` 的 `enqueue_assets()` 方法中，在現有的 `admin-tabs.css` 和 `developer-tab.css` 之後加入：
    ```php
    wp_enqueue_style('line-hub-admin-views', $url . 'assets/css/admin-views.css', [], $ver);
    ```

    注意：不要動 admin-tabs.css 和 developer-tab.css 的內容和載入順序。admin-views.css 是新增的第三個 CSS 檔案。
  </action>
  <verify>
    <automated>php -r "echo file_exists('assets/css/admin-views.css') ? 'CSS exists' : 'MISSING';" && grep -c 'admin-views.css' includes/admin/class-settings-page.php</automated>
    <manual>確認 admin-views.css 檔案內容包含上述所有 class 定義</manual>
  </verify>
  <done>admin-views.css 存在且包含所有必要的 CSS class，class-settings-page.php 已註冊載入此 CSS 檔案</done>
</task>

<task type="auto">
  <name>Task 2: 替換 7 個 Admin view 模板的 inline style</name>
  <files>
    includes/admin/views/tab-webhook.php
    includes/admin/views/tab-wizard.php
    includes/admin/views/tab-line-settings.php
    includes/admin/views/tab-login-settings.php
    includes/admin/views/tab-developer.php
    includes/admin/views/partials/connection-status.php
  </files>
  <action>
    逐一替換每個 view 模板中的 `style="..."` 為對應的 CSS class。以下是具體的替換規則：

    **tab-webhook.php（16 個 inline style）：**
    - `<div class="card" style="max-width: 1000px;">` → `<div class="card lh-card-narrow">`
    - `style="color: #999;"` → `class="lh-text-muted"`
    - `style="color: #666;"` → `class="lh-text-secondary"`
    - `style="margin-top: 16px;"` 在 table 上 → 加 `class="lh-mt-16"` 到 table
    - th 的 `style="width: XXpx;"` → 對應的 `.lh-col-XX` class
    - `style="font-size: 11px;"` 在 code → `class="lh-code-uid"`
    - `style="color: #999;"` 在 span → `class="lh-text-muted"`
    - `style="color: #46b450;"` → `class="lh-text-success"`
    - payload div 的 `style="display:none; margin-top:10px; padding:10px; background:#f5f5f5; border:1px solid #ddd; border-radius:3px;"` → `class="lh-payload-panel"`
    - pre 的 `style="overflow-x:auto; font-size:12px; max-height:300px;"` → `class="lh-payload-content"`

    **tab-wizard.php（5 個 inline style）：**
    - `style="max-width: 1000px;"` → `class="card lh-card-narrow"`
    - `style="max-width: 1000px; margin-top: 20px;"` → `class="card lh-card-narrow-spaced"`
    - `style="margin-top: 20px;"` → `class="lh-mt-20"`
    - `style="margin-left: 8px;"` → `class="... lh-ml-8"`（保留原有 class）
    - `style="cursor: pointer; font-weight: 600; font-size: 14px; padding: 8px 0;"` → `class="lh-wizard-summary"`
    - `style="margin-top: 15px; line-height: 2;"` → `class="lh-wizard-steps"`

    **tab-line-settings.php（8 個 inline style）：**
    - `style="max-width: 1000px;"` → `class="card lh-card-narrow"`
    - `style="max-width: 1000px; margin-top: 20px;"` → `class="card lh-card-narrow-spaced"`
    - code 的 `style="background: #f5f5f5; padding: 8px 12px; display: inline-block;"` → `class="lh-code-display"`
    - form 的 `style="margin: -10px 0 0 0;"` → `class="lh-form-offset"`

    **tab-login-settings.php（14 個 inline style）：**
    - `style="max-width: 1000px;"` → `class="card lh-card-narrow"`
    - `style="display: block; margin-bottom: 8px;"` → `class="lh-label-block"`
    - `style="display: block; margin-bottom: 4px;"` → `class="lh-label-block-sm"`
    - `style="display: block; margin-bottom: 6px;"` → `class="lh-label-block-md"`
    - 動態的 radio margin：`style="<?php echo $value !== 'small' ? 'margin-left: 15px;' : ''; ?>"` → `class="<?php echo $value !== 'small' ? 'lh-radio-inline-spaced' : ''; ?>"`
    - code 的 `style="background: #f5f5f5; padding: 8px 12px; display: inline-block; font-size: 14px;"` → `class="lh-code-display lh-code-display-lg"`
    - code 的 `style="background: #f5f5f5; padding: 8px 12px; display: inline-block; font-size: 13px;"` → `class="lh-code-display lh-code-display-sm"`
    - `style="margin-left: 8px;"` → `class="... lh-ml-8"`

    **tab-developer.php（26 個 inline style）：**
    - `style="margin-top: 0;"` → `class="lh-dev-card lh-mt-0"`
    - API Key banner div `style="background: #dcfce7; ..."` → `class="lh-api-key-banner"`
    - banner 標題 `style="margin: 0 0 8px 0; font-weight: 600; color: #166534;"` → `class="lh-api-key-banner-title"`
    - API Key code `style="font-size: 14px; background: #fff; ..."` → `class="lh-api-key-code"`
    - `style="margin-left: 8px;"` → `class="... lh-ml-8"`
    - `style="margin-top: 10px;"` 和 `style="margin-top: 16px;"` → `class="... lh-mt-10"` / `class="... lh-mt-16"`
    - `style="color: #dc2626;"` → `class="... lh-text-danger"`
    - `style="margin-left: auto; font-size: 13px; color: #6b7280;"` → `class="lh-endpoint-title"`
    - th 的 `style="width: XXpx;"` → 對應的 `.lh-col-XX` class
    - `style="color: #999; margin-top: 16px;"` → `class="lh-text-muted lh-mt-16"`
    - `style="margin-top: 16px;"` 在 log table → `class="lh-dev-log-table lh-mt-16"`
    - `style="font-size: 12px;"` → `class="lh-code-ip"`

    **connection-status.php（9 個 inline style）：**
    - `style="margin: 20px 0;"` → `class="lh-mt-20"`（或定義 `.lh-status-section { margin: 20px 0; }`）
    - `style="list-style: none; padding-left: 0;"` → `class="lh-status-list"`
    - `style="margin: 8px 0;"` → `class="lh-status-item"`
    - `style="margin-top: 20px;"` 在 h3 → `class="lh-mt-20"`
    - `style="color: #996800;"` → `class="lh-text-warning"`

    **重要注意事項：**
    - 保留所有原有的 class（如 `card`, `wp-list-table`, `widefat`），只移除 `style=""` 屬性
    - 動態 PHP 生成的 style 也要改為動態 class（如 login-settings.php 的 radio margin）
    - `form` 上的 `style="display:none;"` 只用在隱藏表單（如 liff-template.php 的 liffForm），admin view 中沒有此情況
    - `tab-developer.php` 中的 `style="margin-top: 0;"` 覆蓋了 `.lh-dev-card` 的預設 `margin-top: 20px`，需要用 `.lh-mt-0` 覆蓋
  </action>
  <verify>
    <automated>grep -rn 'style="' includes/admin/views/ includes/admin/views/partials/ | grep -v 'ABSPATH' | wc -l</automated>
    <manual>結果應為 0。然後在瀏覽器開啟後台 LINE Hub 設定頁面，逐一檢查 5 個 Tab 的視覺排版是否一致</manual>
  </verify>
  <done>7 個 admin view 檔案中零 inline style 屬性，且後台 5 個 Tab 視覺排版不變</done>
</task>

</tasks>

<verification>
1. `grep -rn 'style="' includes/admin/views/ includes/admin/views/partials/` — 結果為零
2. 開啟 https://test.buygo.me/wp-admin/admin.php?page=line-hub-settings 逐一檢查 5 個 Tab
3. 確認 CSS 檔案在頁面原始碼中正確載入（`<link>` 標籤包含 admin-views.css）
</verification>

<success_criteria>
1. Admin view 模板中零 inline style 屬性
2. 新增的 CSS class 與原本 inline style 視覺效果完全一致
3. admin-views.css 透過 wp_enqueue_style 正確載入
</success_criteria>

<output>
After completion, create `.planning/phases/13-樣式外部化/13-01-SUMMARY.md`
</output>
