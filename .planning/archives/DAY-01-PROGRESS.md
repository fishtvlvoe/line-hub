# Day 1 é€²åº¦å ±å‘Š

**æ—¥æœŸ**: 2026-02-06
**éšæ®µ**: Week 1 - æ¶æ§‹å‡ç´šèˆ‡å¾Œå°éª¨æ¶
**ä»»å‹™**: æ¶æ§‹è¨­è¨ˆèˆ‡è¦ç¯„ç¢ºèª

---

## âœ… è¨ˆç•«ä»»å‹™

- [x] ç¹ªè£½åŠŸèƒ½æ¶æ§‹åœ–
- [x] è¨­è¨ˆè³‡æ–™åº« Schema
- [x] è¦åŠƒ API ç«¯é»
- [x] WordPress è¦ç¯„æª¢æŸ¥
- [x] ç”¢å‡ºæ–‡ä»¶

---

## ğŸ¯ å¯¦éš›å®Œæˆ

### 1. LINE-HUB-ARCHITECTURE.md

**å…§å®¹**:
- âœ… ç³»çµ±æ¶æ§‹ç¸½è¦½ï¼ˆ6 å±¤æ¶æ§‹ï¼‰
- âœ… æ ¸å¿ƒæµç¨‹è¨­è¨ˆï¼ˆLINE ç™»å…¥ã€Webhookã€è¨Šæ¯ç™¼é€ï¼‰
- âœ… å‘½åç©ºé–“èˆ‡ Hook ç­–ç•¥
- âœ… å®‰å…¨èˆ‡é©—è­‰æ©Ÿåˆ¶
- âœ… æ¨¡çµ„è¨­è¨ˆï¼ˆ7 å€‹æ ¸å¿ƒæœå‹™ï¼‰
- âœ… å¾Œå°é é¢çµæ§‹ï¼ˆ6 å€‹ Tabï¼‰
- âœ… èˆ‡ buygo-line-notify çš„é—œä¿‚ï¼ˆ3 éšæ®µé·ç§»ï¼‰
- âœ… å¯æ“´å±•æ€§è¨­è¨ˆ
- âœ… é©—æ”¶æ¨™æº–å®šç¾©

**é—œéµæ±ºç­–**:

| æ±ºç­–é …ç›® | æ–¹æ¡ˆ | åŸå›  |
|---------|------|------|
| å‘½åç©ºé–“ | `LineHub` | èˆ‡ `BuygoLineNotify` å®Œå…¨éš”é›¢ï¼Œé¿å…è¡çª |
| Hook å„ªå…ˆç´š | 15 | æ™šæ–¼ NSL (10)ï¼Œç¢ºä¿ä¸è¦†è“‹ç¾æœ‰åŠŸèƒ½ |
| è³‡æ–™è¡¨ | ç¨ç«‹ 4 è¡¨ | ä¸ä¾è³´ buygo-line-notifyï¼Œç¨ç«‹ç®¡ç† |
| OAuth æµç¨‹ | State Token + Transient | CSRF é˜²è­·ï¼Œ10 åˆ†é˜è‡ªå‹•éæœŸ |
| Webhook è™•ç† | éåŒæ­¥è™•ç† | ç«‹å³è¿”å› 200ï¼Œé¿å… LINE è¶…æ™‚ |

### 2. DATABASE-SCHEMA.md

**è¨­è¨ˆçš„è³‡æ–™è¡¨**:

1. **wp_line_hub_users** - ç”¨æˆ¶ç¶å®šè¡¨
   - å„²å­˜ LINE UID â†” WordPress User ID ç¶å®š
   - åŒ…å« display_name, picture_url, email
   - UNIQUE ç´¢å¼•é˜²æ­¢é‡è¤‡ç¶å®š

2. **wp_line_hub_webhooks** - Webhook è¨˜éŒ„è¡¨
   - è¨˜éŒ„æ‰€æœ‰ LINE äº‹ä»¶
   - ç”¨æ–¼å»é‡å’Œå¯©è¨ˆ
   - 30 å¤©è‡ªå‹•æ¸…ç†ç­–ç•¥

3. **wp_line_hub_settings** - é€²éšè¨­å®šè¡¨
   - JSON æ ¼å¼å„²å­˜è¤‡é›œè¨­å®š
   - æ”¯æ´åŠ å¯†å„²å­˜ï¼ˆæ•æ„Ÿè³‡æ–™ï¼‰
   - åˆ†é¡ç®¡ç†ï¼ˆgeneral, notification, integrationï¼‰

4. **wp_line_hub_notifications** - è¨Šæ¯è¨˜éŒ„è¡¨
   - è¿½è¹¤æ‰€æœ‰ç™¼é€çš„è¨Šæ¯
   - æˆåŠŸç‡çµ±è¨ˆ
   - 90 å¤©ä¿ç•™æœŸ

**æ•ˆèƒ½å„ªåŒ–**:
- âœ… ç´¢å¼•ç­–ç•¥ï¼ˆUNIQUE + å¤šå€‹ KEYï¼‰
- âœ… å¿«å–ç­–ç•¥ï¼ˆTransient 1 å°æ™‚ï¼‰
- âœ… è³‡æ–™æ¸…ç†ç­–ç•¥ï¼ˆé¿å…è³‡æ–™è¡¨éå¤§ï¼‰

### 3. API-ENDPOINTS.md

**è¨­è¨ˆçš„ API ç«¯é»**:

| ç«¯é» | æ–¹æ³• | ç”¨é€” |
|------|------|------|
| `/webhook` | POST | æ¥æ”¶ LINE Webhook |
| `/login/authorize` | GET | å–å¾—æˆæ¬Š URL |
| `/login/callback` | GET | OAuth å›å‘¼ |
| `/binding/status` | GET | æŸ¥è©¢ç¶å®šç‹€æ…‹ |
| `/binding/link` | POST | ç¶å®š LINE |
| `/binding/unlink` | POST | è§£é™¤ç¶å®š |
| `/settings` | GET/POST | è¨­å®šç®¡ç† |
| `/notifications/send` | POST | ç™¼é€æ¸¬è©¦è¨Šæ¯ |
| `/notifications/history` | GET | æŸ¥è©¢ç™¼é€è¨˜éŒ„ |
| `/webhooks/history` | GET | æŸ¥è©¢ Webhook è¨˜éŒ„ |

**èªè­‰æ–¹å¼**:
- âœ… HMAC ç°½åé©—è­‰ï¼ˆWebhookï¼‰
- âœ… WordPress Cookie + Nonceï¼ˆå¾Œå° APIï¼‰
- âœ… State Tokenï¼ˆOAuthï¼‰

**å®‰å…¨æ©Ÿåˆ¶**:
- âœ… Rate Limitingï¼ˆ60 req/minï¼‰
- âœ… CORS è¨­å®š
- âœ… æ•æ„Ÿè³‡æ–™é®ç½©
- âœ… éŒ¯èª¤ä»£ç¢¼æ¨™æº–åŒ–

---

## ğŸ¨ æ¶æ§‹äº®é»

### 1. å‘½åç©ºé–“éš”é›¢

```php
// LINE Hub (æ–°)
namespace LineHub;
namespace LineHub\Auth;
namespace LineHub\Services;

// BuyGo LINE Notify (èˆŠ)
namespace BuygoLineNotify;
```

**å„ªé»**:
- å®Œå…¨éš”é›¢ï¼Œé¿å…é¡åˆ¥åç¨±è¡çª
- å¯èˆ‡ buygo-line-notify å…±å­˜ï¼ˆé·ç§»æœŸï¼‰
- æ¸…æ™°çš„ç¨‹å¼ç¢¼çµ„ç¹”

### 2. æœå‹™å°å‘æ¶æ§‹

```
å±•ç¤ºå±¤ (Admin Pages, Shortcodes)
    â–¼
REST API å±¤ (Webhook, Login, Binding)
    â–¼
æœå‹™å±¤ (Auth, User, Messaging, Notification)
    â–¼
è³‡æ–™å±¤ (Database)
```

**å„ªé»**:
- æ¯å±¤è·è²¬å–®ä¸€
- æ˜“æ–¼æ¸¬è©¦å’Œç¶­è­·
- å¯æ“´å±•æ€§é«˜

### 3. Hook æ•´åˆç­–ç•¥

**å°å¤–æä¾›**:
```php
do_action('line_hub/user_logged_in', $user_id, $line_uid);
do_action('line_hub/webhook/message', $event, $user_id);
apply_filters('line_hub/message/before_send', $message);
```

**ç›£è½å¤–éƒ¨**:
```php
add_action('buygo/order_created', 'LineHub\notify_order', 20);
add_action('fluent_cart/order_completed', 'LineHub\notify_fluentcart', 20);
```

**å„ªé»**:
- èˆ‡å…¶ä»–å¤–æ›ç„¡ç¸«æ•´åˆ
- å„ªå…ˆç´šç®¡ç†é¿å…è¡çª
- å¯æ“´å±•æ€§å¼·

---

## ğŸ“Š æ¶æ§‹å°æ¯”

### vs buygo-line-notify

| é …ç›® | buygo-line-notify | LINE Hub |
|------|------------------|----------|
| å‘½åç©ºé–“ | `BuygoLineNotify` | `LineHub` |
| è³‡æ–™è¡¨ | `wp_buygo_line_*` | `wp_line_hub_*` |
| OAuth | ä¾è³´ NSL | ç¨ç«‹å¯¦ç¾ |
| å¾Œå°è¨­è¨ˆ | ç°¡å–®è¨­å®šé  | 6 å€‹ Tab ç›´è¦ºä»‹é¢ |
| é€šçŸ¥å ´æ™¯ | è¨‚å–®ã€å‡ºè²¨ | è¨‚å–®ã€å‡ºè²¨ã€æœƒå“¡ã€è‡ªè¨‚ |
| Webhook | åŸºæœ¬è™•ç† | çµ±ä¸€ä¸­å¿ƒã€è¨˜éŒ„ã€é™¤éŒ¯ |
| å¯æ“´å±•æ€§ | æœ‰é™ | é«˜ï¼ˆé ç•™ Hookï¼‰ |

### vs NSL (Nextend Social Login)

| é …ç›® | NSL | LINE Hub |
|------|-----|----------|
| ç”¨é€” | å¤šå¹³å°ç¤¾äº¤ç™»å…¥ | LINE å°ˆç”¨æ•´åˆ |
| è¤‡é›œåº¦ | é«˜ï¼ˆæ”¯æ´ 20+ å¹³å°ï¼‰ | ä½ï¼ˆåªå°ˆæ³¨ LINEï¼‰ |
| å¾Œå°è¨­å®š | è¤‡é›œ | ç›´è¦ºç°¡æ½” |
| WordPress æ•´åˆ | ä¸€èˆ¬ | æ·±åº¦æ•´åˆï¼ˆé€šçŸ¥ã€Webhookï¼‰ |
| Email è™•ç† | æœ‰é™ | å®Œæ•´ï¼ˆæ“·å–ã€é©—è­‰ã€é‡æ–°èªè­‰ï¼‰ |

---

## ğŸš€ ä¸‹ä¸€æ­¥è¨ˆç•«

### Day 2: å¾Œç«¯æ¶æ§‹å¯¦ä½œ (Phase 1.1, 1.2)

**ä¸Šåˆä»»å‹™**:
- [ ] å»ºç«‹ `LineHub\Services\SettingsService` é¡åˆ¥
- [ ] å¯¦ä½œè¨­å®š Schema å®šç¾©
- [ ] å¯¦ä½œ `get()`, `set()`, `encrypt()`, `decrypt()` æ–¹æ³•

**ä¸‹åˆä»»å‹™**:
- [ ] å»ºç«‹ `LineHub\API\Settings_API` é¡åˆ¥
- [ ] è¨»å†Š REST API ç«¯é»
- [ ] å¯¦ä½œ GET/POST `/line-hub/v1/settings`
- [ ] é©—è­‰å’ŒéŒ¯èª¤è™•ç†

**é©—æ”¶æ¨™æº–**:
- [ ] å¯é€é Postman å–å¾—è¨­å®š
- [ ] å¯é€é Postman æ›´æ–°è¨­å®š
- [ ] æ•æ„Ÿè³‡æ–™åŠ å¯†å„²å­˜
- [ ] å–®å…ƒæ¸¬è©¦é€šé

---

## ğŸ“ è¨˜éŒ„èˆ‡å­¸ç¿’

### è¨­è¨ˆæ¨¡å¼æ‡‰ç”¨

1. **Singleton Pattern** - Plugin é¡åˆ¥
2. **Facade Pattern** - å°å¤–æä¾›ç°¡å–®ä»‹é¢
3. **Service Layer Pattern** - å•†æ¥­é‚è¼¯å°è£
4. **Repository Pattern** - è³‡æ–™å­˜å–æŠ½è±¡

### WordPress æœ€ä½³å¯¦è¸

1. âœ… ä½¿ç”¨ `dbDelta()` å»ºç«‹è³‡æ–™è¡¨
2. âœ… ä½¿ç”¨ `$wpdb->prepare()` é˜²æ­¢ SQL Injection
3. âœ… ä½¿ç”¨ `sanitize_*()` é©—è­‰è¼¸å…¥
4. âœ… ä½¿ç”¨ Transient å¿«å–
5. âœ… ä½¿ç”¨ `wp_schedule_single_event()` éåŒæ­¥è™•ç†

### å®‰å…¨è€ƒé‡

1. âœ… HMAC ç°½åé©—è­‰ï¼ˆWebhookï¼‰
2. âœ… State Token CSRF é˜²è­·ï¼ˆOAuthï¼‰
3. âœ… Nonce é©—è­‰ï¼ˆREST APIï¼‰
4. âœ… æ•æ„Ÿè³‡æ–™åŠ å¯†ï¼ˆAES-256ï¼‰
5. âœ… Rate Limitingï¼ˆé˜²æ­¢æ¿«ç”¨ï¼‰

---

## ğŸ’¡ æŠ€è¡“äº®é»

### 1. éåŒæ­¥ Webhook è™•ç†

```php
// ç«‹å³è¿”å› 200 OK
wp_send_json_success(['message' => 'Webhook å·²æ¥æ”¶']);

// èƒŒæ™¯è™•ç†äº‹ä»¶
wp_schedule_single_event(time(), 'line_hub_process_webhook', [$event]);
```

**å„ªé»**: é¿å… LINE è¶…æ™‚é‡ç™¼ï¼Œæå‡ç©©å®šæ€§

### 2. å»é‡æ©Ÿåˆ¶

```php
$key = 'line_hub_webhook_' . $webhook_event_id;
if (get_transient($key)) {
    return; // é‡è¤‡äº‹ä»¶ï¼Œè·³é
}
set_transient($key, true, 60); // 60 ç§’éæœŸ
```

**å„ªé»**: é˜²æ­¢é‡è¤‡è™•ç†åŒä¸€äº‹ä»¶

### 3. åŠ å¯†å„²å­˜

```php
function encrypt($value): string {
    $key = NONCE_KEY;
    $iv = openssl_random_pseudo_bytes(16);
    $encrypted = openssl_encrypt($value, 'AES-256-CBC', $key, 0, $iv);
    return base64_encode($iv . $encrypted);
}
```

**å„ªé»**: Channel Secret å’Œ Access Token å®‰å…¨å„²å­˜

---

## âœ… é©—æ”¶çµæœ

### æ¶æ§‹æ–‡ä»¶æª¢æŸ¥

- [x] æ¶æ§‹åœ–æ¸…æ™°æ˜“æ‡‚
- [x] æµç¨‹åœ–å®Œæ•´è©³ç´°
- [x] å‘½åç©ºé–“è¨­è¨ˆåˆç†
- [x] Hook ç­–ç•¥æ˜ç¢º
- [x] å®‰å…¨æ©Ÿåˆ¶å®Œå–„

### è³‡æ–™åº«è¨­è¨ˆæª¢æŸ¥

- [x] è³‡æ–™è¡¨çµæ§‹ç¬¦åˆ WordPress è¦ç¯„
- [x] ç´¢å¼•è¨­è¨ˆåˆç†
- [x] å¸¸è¦‹æŸ¥è©¢ç¯„ä¾‹å®Œæ•´
- [x] è³‡æ–™æ¸…ç†ç­–ç•¥æ˜ç¢º
- [x] Migration è…³æœ¬å¯ç”¨

### API è¨­è¨ˆæª¢æŸ¥

- [x] ç«¯é»å‘½åç¬¦åˆ RESTful è¦ç¯„
- [x] èªè­‰æ–¹å¼å®‰å…¨å¯é 
- [x] Request/Response æ ¼å¼æ¸…æ™°
- [x] éŒ¯èª¤è™•ç†å®Œæ•´
- [x] å®‰å…¨æ©Ÿåˆ¶å®Œå–„

---

## ğŸ“ˆ é€²åº¦ç¸½çµ

### æ™‚é–“åˆ†é…

| ä»»å‹™ | è¨ˆç•«æ™‚é–“ | å¯¦éš›æ™‚é–“ | ç‹€æ…‹ |
|------|---------|---------|------|
| åŠŸèƒ½æ¶æ§‹åœ– | 1.5h | 1.5h | âœ… å®Œæˆ |
| è³‡æ–™åº«è¨­è¨ˆ | 1.5h | 1.5h | âœ… å®Œæˆ |
| API ç«¯é»è¦åŠƒ | 1.5h | 1.5h | âœ… å®Œæˆ |
| WordPress è¦ç¯„æª¢æŸ¥ | 1.5h | 1.5h | âœ… å®Œæˆ |
| æ–‡ä»¶æ’°å¯« | - | - | âœ… å®Œæˆ |
| **ç¸½è¨ˆ** | **6h** | **6h** | âœ… **å¦‚æœŸå®Œæˆ** |

### ç”¢å‡ºçµ±è¨ˆ

- ğŸ“„ æ–‡ä»¶æ•¸é‡: 3 å€‹
- ğŸ“Š ç¸½å­—æ•¸: ~8,000 å­—
- ğŸ—‚ï¸ è³‡æ–™è¡¨è¨­è¨ˆ: 4 å€‹
- ğŸ”Œ API ç«¯é»: 11 å€‹
- ğŸ¨ æ¶æ§‹åœ–: 3 å€‹
- âœ… Git commit: 1 å€‹

---

## ğŸ¯ æ˜æ—¥é å‘Š

**Day 2: å¾Œç«¯æ¶æ§‹å¯¦ä½œ**

é‡é»ï¼š
- å»ºç«‹çµ±ä¸€è¨­å®šç®¡ç†ç³»çµ±
- å¯¦ä½œè¨­å®š REST API
- é–‹å§‹æ’°å¯«å–®å…ƒæ¸¬è©¦

é è¨ˆç”¢å‡ºï¼š
- `LineHub\Services\SettingsService`
- `LineHub\API\Settings_API`
- å–®å…ƒæ¸¬è©¦æ¡†æ¶

---

**å ±å‘Šå»ºç«‹**: 2026-02-06
**åŸ·è¡Œæ¨¡å¼**: Auto Run
**ä¸‹æ¬¡å ±å‘Š**: Day 2 (17:00)
